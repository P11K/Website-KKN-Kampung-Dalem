<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kampungdalem Kota Kediri</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/l1.png" />
    <link href="assets/l1.png" rel="icon">
    <!-- <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon"> -->
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link href="css/main.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .data-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
      }
      .data-item {
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
        flex: 1 1 calc(33% - 20px);
        min-width: 200px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        color: white;
      }
      .data-item:nth-child(1) { background-color: #4da8e5; }
      .data-item:nth-child(2) { background-color: #e75a4b; }
      .data-item:nth-child(3) { background-color: #e0cc7c; }
      .data-item:nth-child(4) { background-color: #6dcbb8; }
      .data-item:nth-child(5) { background-color: #c09ece; }
      .data-item:nth-child(6) { background-color: #ffc898; }
      
      .data-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      /* Ubah ukuran font pada container jumlah */
      .data-item h2 {
        font-size: 24px; /* Ukuran font untuk judul */
        margin-bottom: 10px;
      }
      .data-item p {
        font-size: 32px; /* Ukuran font untuk angka */
        font-weight: bold;
        margin: 0;
      }

      /* Perbesar ukuran grafik */
      .chart-container {
        width: 100%;
        max-width: 1000px; /* Lebar maksimal grafik */
        margin: auto;
        height: 500px; /* Tinggi grafik */
      }
      #pendudukChart {
        width: 100% !important;
        height: 100% !important;
      }
      .year-selector {
        display: flex;
        flex-wrap: wrap; /* Agar tombol turun ke baris baru jika tidak muat */
        gap: 10px; /* Jarak antar tombol */
        margin-bottom: 20px; /* Jarak ke elemen bawah */
    }
    
    
    </style>
</head>
<body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark hidden" id="mainNav">

            <div class="container">
                <a class="navbar-brand" href="#page-top"><img src="assets/img/kota.png" style="width: 50px; height: auto;"
                        alt="Logo" class="logo" /></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link" href="index.php">Beranda</a></li>
                        <li class="nav-item"><a class="nav-link active" href="data.html">Data Penduduk</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.php#profile">Profile</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.php#portfolio">Berita dan Galeri</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container">
            <h1>Data Penduduk</h1>
            <div class="year-selector" id="year-buttons"></div>
            <div class="data-container">
                <div class="data-item"><h2>Jumlah Penduduk</h2><p id="total-penduduk">0</p></div>
                <div class="data-item"><h2>Jumlah Balita</h2><p id="total-balita">0</p></div>
                <div class="data-item"><h2>Jumlah Lansia</h2><p id="total-lansia">0</p></div>
                <div class="data-item"><h2>Jumlah Ibu Hamil</h2><p id="total-ibu-hamil">0</p></div>
                <div class="data-item"><h2>Jumlah Laki-laki</h2><p id="total-laki">0</p></div>
                <div class="data-item"><h2>Jumlah Perempuan</h2><p id="total-perempuan">0</p></div>
            </div>
            <div class="chart-container">
                <canvas id="pendudukChart"></canvas>
            </div>
        </div>
        <script>
            let chartInstance = null; // Variabel global untuk menyimpan instance grafik
            let availableYears = []; // Untuk menyimpan daftar tahun yang tersedia
        
            function fetchData(year) {
                try {
                    fetch(`datapenduduk.php?year=${year}`)
                        .then(response => response.json())
                        .then(data => {
                            console.log("Data yang diterima:", data);
        
                            document.getElementById('total-penduduk').textContent = data.total_penduduk ?? "0";
                            document.getElementById('total-balita').textContent = data.total_balita ?? "0";
                            document.getElementById('total-lansia').textContent = data.total_lansia ?? "0";
                            document.getElementById('total-ibu-hamil').textContent = data.total_ibu_hamil ?? "0";
                            document.getElementById('total-laki').textContent = data.total_laki ?? "0";
                            document.getElementById('total-perempuan').textContent = data.total_perempuan ?? "0";
        
                            updateActiveButton(year);
        
                            // Jika tahun terbaru dipilih, ambil juga data tahun sebelumnya
                            if (year > Math.min(...availableYears)) {
                                fetchComparisonData(year);
                            } else {
                                renderChart(data, null); // Hanya tampilkan satu tahun
                            }
                        });
                } catch (error) {
                    console.error("Error fetching data:", error);
                }
            }
        
            function fetchComparisonData(currentYear) {
                let previousYear = currentYear - 1;
        
                fetch(`datapenduduk.php?year=${previousYear}`)
                    .then(response => response.json())
                    .then(prevData => {
                        fetch(`datapenduduk.php?year=${currentYear}`)
                            .then(response => response.json())
                            .then(currentData => {
                                renderChart(currentData, prevData);
                            });
                    })
                    .catch(error => console.error(`Gagal mengambil data tahun ${previousYear}:`, error));
            }
        
            function updateYearButtons(years) {
                const yearSelector = document.querySelector(".year-selector");
                yearSelector.innerHTML = ""; // Bersihkan tombol lama
                availableYears = years; // Simpan tahun yang tersedia
        
                years.forEach(year => {
                    const button = document.createElement("button");
                    button.classList.add("btn", "btn-secondary");
                    button.textContent = year;
                    button.onclick = () => fetchData(year);
                    yearSelector.appendChild(button);
                });
        
                // Set tombol awal ke tahun terbaru
                if (years.length > 0) {
                    fetchData(years[0]); // Ambil data tahun terbaru
                }
            }
        
            fetch("datapenduduk.php?year=2023")
                .then(response => response.json())
                .then(data => {
                    if (data.available_years) {
                        updateYearButtons(data.available_years);
                    }
                })
                .catch(error => console.error("Gagal mengambil daftar tahun:", error));
        
            function updateActiveButton(year) {
                const buttons = document.querySelectorAll(".year-selector button");
        
                buttons.forEach(button => {
                    if (button.textContent == year) {
                        button.classList.add("btn-primary");
                        button.classList.remove("btn-secondary");
                    } else {
                        button.classList.add("btn-secondary");
                        button.classList.remove("btn-primary");
                    }
                });
            }
        
            function renderChart(data, prevData = null) {
                const ctx = document.getElementById('pendudukChart').getContext('2d');
            
                // Hapus grafik lama jika sudah ada
                if (chartInstance) {
                    chartInstance.destroy();
                }
            
                // Warna untuk tahun terbaru
                const currentColors = [
                    '#4da8e5', // Total Penduduk
                    '#e75a4b', // Balita
                    '#e0cc7c', // Lansia
                    '#6dcbb8', // Ibu Hamil
                    '#c09ece', // Laki-laki
                    '#ffc898'  // Perempuan
                ];
            
                // Warna lebih transparan untuk tahun sebelumnya
                const previousColors = [
                    'rgba(77, 168, 229, 0.4)',
                    'rgba(231, 90, 75, 0.4)',
                    'rgba(224, 204, 124, 0.4)',
                    'rgba(109, 203, 184, 0.4)',
                    'rgba(192, 158, 206, 0.4)',
                    'rgba(255, 200, 152, 0.4)'
                ];
            
                let datasets = [{
                    label: `Tahun ${data.year}`,
                    data: [
                        data.total_penduduk, 
                        data.total_balita, 
                        data.total_lansia, 
                        data.total_ibu_hamil, 
                        data.total_laki, 
                        data.total_perempuan
                    ],
                    backgroundColor: currentColors,
                    borderWidth: 1
                }];
            
                // Jika ada data tahun sebelumnya, tambahkan ke chart
                if (prevData) {
                    datasets.push({
                        label: `Tahun ${prevData.year}`,
                        data: [
                            prevData.total_penduduk, 
                            prevData.total_balita, 
                            prevData.total_lansia, 
                            prevData.total_ibu_hamil, 
                            prevData.total_laki, 
                            prevData.total_perempuan
                        ],
                        backgroundColor: previousColors,
                        borderWidth: 1
                    });
                }
            
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Total Penduduk', 'Balita', 'Lansia', 'Ibu Hamil', 'Laki-laki', 'Perempuan'],
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
            
        
            fetchData(2023);
        </script>
        
    
<!-- Footer-->
<footer id="footer" class="footer">
    <div class="container footer-top">
        <div class="row gy-4">
            <div class="col-lg-4 col-md-6 footer-about">
                <a href="index.html" class="d-flex align-items-center">
                    <img src="assets/l1.png" style="width: 50px; height: auto;" alt="Logo" class="logo" />
                    <span class="sitename"> Kampungdalem</span>
                </a>
                <div class="footer-contact pt-3">
                    <p>Jl. Brigjen Katamso No.17, KampungDalem, Kec. Kota, Kota Kediri, Jawa Timur 64129</p>
                    <p class="mt-3"><strong>Telepon:</strong> <span>0354-696997</span></p>
                    <p><strong>Email:</strong> <span>Kampungdalem@gmail.com</span></p>
                </div>
            </div>
    
            <div class="col-lg-2 col-md-3 footer-links">
                <h4>Useful Links</h4>
                <ul>
                    <li><i class="bi bi-chevron-right"></i> <a href="#">Home</a></li>
                    <li><i class="bi bi-chevron-right"></i> <a href="data.html">Data</a></li>
                    <li><i class="bi bi-chevron-right"></i> <a href="#profile">Profile</a></li>
                    <li><i class="bi bi-chevron-right"></i> <a href="#portfolio">Berita dan Galeri</a></li>
                </ul>
            </div>
    
            <div class="col-lg-4 col-md-12">
                <h4>Follow Us</h4>
                <p>Untuk mengetahui kegiatan yang lebih lengkap di media sosial di bawah ini.</p>
                <div class="social-links d-flex">
                    <!-- <a href=""><i class="bi bi-whatsapp"></i></a> -->
                    <a href=""><i class="bi bi-facebook"></i></a>
                    <a href="https://www.instagram.com/kelurahan_kampungdalem/" target="_blank"><i class="bi bi-instagram"></i></a>
                    <!-- <a href="https://www.youtube.com/"><i class="bi bi-youtube"></i></a> -->
                </div>
            </div>
    
        </div>
    </div>
    
    <div class="container copyright text-center mt-4">
        <p>Â© <span>Copyright</span> <strong class="px-1 sitename">Kampungdalem</strong> <span>All Rights
                Reserved</span></p>
        <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you've purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
            Designed by <a href="https://www.instagram.com/kknt24.kampungdalem2025/">KKN-T Kampungdalem 2025</a>
        </div>
    </div>
    </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script> -->
</body>
</html>